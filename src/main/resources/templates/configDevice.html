<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>SmartTrack | Configurazione Hardware</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body class="dashboard-body">
<div class="app-container">
    <aside class="sidebar glass-card">
        <div class="sidebar-logo"><i class="fas fa-box-open"></i> SmartTrack</div>
        <nav class="sidebar-nav">
            <a th:href="@{/profile}" class="nav-btn"><i class="fas fa-user"></i> Profilo</a>
            <a th:href="@{/web/devices}" class="nav-btn active"><i class="fas fa-microchip"></i> Dispositivi</a>
            <a th:href="@{/logout}" class="nav-btn logout-link"><i class="fas fa-power-off"></i> Logout</a>
        </nav>
    </aside>

    <main class="main-content">
        <header class="profile-header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <a th:href="@{/web/devices}" class="btn-copy" style="padding: 10px 15px;"><i class="fas fa-chevron-left"></i></a>
                <h1>Configurazione Hardware</h1>
            </div>
        </header>

        <div class="profile-grid">
            <section class="glass-card section-box">
                <h3><i class="fas fa-microchip"></i> Identit√† Device</h3>
                <div class="data-group">
                    <div class="data-item"><label>ID univoco</label><p id="dispId">Caricamento...</p></div>
                    <div class="data-item"><label>Modello</label><p id="dispModel">-</p></div>
                    <div class="data-item"><label>API Key</label><p><code id="dispKey">********</code></p></div>
                </div>
            </section>

            <section class="glass-card section-box">
                <h3><i class="fas fa-tools"></i> Manutenzione</h3>
                <div class="data-group">
                    <div class="data-item">
                        <label>Stato Calibrazione</label>
                        <p id="calibStatus">-</p>
                    </div>
                    <button class="btn-auth" onclick="calibrate()">Esegui Ricalibrazione</button>
                </div>
            </section>
        </div>
    </main>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');

        fetch(`/api/device/${id}`)
            .then(res => res.json())
            .then(device => {
                document.getElementById('dispId').innerText = device.deviceId || 'N/A';
                document.getElementById('dispModel').innerText = device.model || 'Standard Sensor';
                document.getElementById('dispKey').innerText = device.apiKey ? device.apiKey.substring(0,8) + '...' : 'Non generata';
                document.getElementById('calibStatus').innerText = device.isCalibrated ? 'CALIBRATO' : 'DA CALIBRARE';
            });
    });
</script>
</body>
</html>